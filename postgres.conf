# -----------------------------
# PostgreSQL configuration file
# OTIMIZADO PARA 80MB RAM + INSERTS
# -----------------------------

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# - Connection Settings -
listen_addresses = '*'
max_connections = 50			# Aumentado para evitar PoolTimedOut
superuser_reserved_connections = 2	# Reservadas para admin

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

# - Memory - OTIMIZADO PARA 80MB
shared_buffers = 16MB			# ~20% da RAM (era 128MB)
work_mem = 1MB				# Reduzido para economizar (era 4MB)
maintenance_work_mem = 8MB		# Para VACUUM/ANALYZE (era 64MB)
effective_cache_size = 40MB		# ~50% da RAM (era 4GB)

# - Disk -
temp_file_limit = 50MB			# Limite de arquivos temporários

# - Asynchronous Behavior -
effective_io_concurrency = 10		# Para containers/SSD (era 1)

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG - OTIMIZADO PARA INSERTS
#------------------------------------------------------------------------------

# - Settings -
synchronous_commit = off		# PERFORMANCE: não espera fsync (era on)
wal_buffers = 1MB			# Buffer WAL adequado (era -1/auto)
wal_writer_delay = 200ms		# Padrão OK

# - Checkpoints - MENOS FREQUENTES
checkpoint_timeout = 10min		# Checkpoints menos frequentes (era 5min)
checkpoint_completion_target = 0.7	# Distribui I/O (era 0.9)
max_wal_size = 32MB			# Reduzido para economizar espaço (era 1GB)
min_wal_size = 8MB			# Reduzido (era 80MB)

# - Commit otimização -
commit_delay = 10000			# Agrupa commits (10ms)
commit_siblings = 5			# Mín transações para delay

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

# - Planner Cost Constants -
random_page_cost = 1.1			# Para SSD/containers (era 4.0)
cpu_tuple_cost = 0.01			# Padrão
cpu_index_tuple_cost = 0.005		# Padrão
cpu_operator_cost = 0.0025		# Padrão

# - JIT desabilitado para economizar recursos -
jit = off				# Desabilita JIT (era on)

#------------------------------------------------------------------------------
# REPORTING AND LOGGING - MINIMALISTA
#------------------------------------------------------------------------------

# - When to Log -
log_min_messages = error		# Apenas erros (era warning)
log_min_error_statement = error		# Apenas erros

# - What to Log -
log_checkpoints = off			# Desabilita log checkpoints (era on)
log_connections = off			# Sem log conexões
log_disconnections = off		# Sem log desconexões
log_duration = off			# Sem log duração
log_statement = 'none'			# Sem log statements

#------------------------------------------------------------------------------
# STATISTICS - MÍNIMO NECESSÁRIO
#------------------------------------------------------------------------------

track_activities = on			# Necessário para pg_stat_activity
track_counts = on			# Necessário para autovacuum
track_io_timing = off			# Desabilita para economizar (era off)
track_functions = none			# Sem tracking de funções

#------------------------------------------------------------------------------
# AUTOVACUUM - OTIMIZADO PARA INSERTS
#------------------------------------------------------------------------------

autovacuum = on				# Manter habilitado
autovacuum_max_workers = 1		# Apenas 1 worker (era 3)
autovacuum_naptime = 30s		# Intervalo reduzido (era 1min)
autovacuum_vacuum_threshold = 100	# Mais agressivo (era 50)
autovacuum_vacuum_scale_factor = 0.1	# Vacuum com 10% mudanças (era 0.2)
autovacuum_analyze_threshold = 50	# Padrão
autovacuum_analyze_scale_factor = 0.05	# Analyze mais frequente (era 0.1)

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

# - Statement Behavior -
statement_timeout = 30000		# 30s timeout para statements
lock_timeout = 10000			# 10s timeout para locks
idle_in_transaction_session_timeout = 60000	# 1min timeout idle

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS PARA PERFORMANCE
#------------------------------------------------------------------------------

# Configurações extras para máxima performance com INSERTs
wal_compression = off			# Sem compressão WAL para velocidade
full_page_writes = on			# Manter segurança (não desabilitar)
wal_log_hints = off			# Sem hints extras
bgwriter_delay = 200ms			# Background writer padrão
bgwriter_lru_maxpages = 50		# Reduzido (era 100)
vacuum_cost_delay = 0			# Sem delay no vacuum
maintenance_io_concurrency = 5		# Para operações de manutenção
